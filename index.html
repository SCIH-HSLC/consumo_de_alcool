<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Controle de Produtos Hospitalares</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

:root {
  --primary-color: #2c3e50;
  --secondary-color: #3498db;
  --accent-color: #1abc9c;
  --light-color: #ecf0f1;
  --dark-color: #2c3e50;
  --danger-color: #e74c3c;
  --warning-color: #f39c12;
  --success-color: #27ae60;
  --gray-color: #95a5a6;
  --card-bg: #ffffff;
  --shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
  --radius: 12px;
}

body {
  background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
  color: #333;
  min-height: 100vh;
  padding: 20px;
  display: flex;
  justify-content: center;
  align-items: center;
}

.container {
  max-width: 800px;
  width: 100%;
  margin: 0 auto;
}

/* Header */
header {
  background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
  border-radius: var(--radius);
  padding: 25px 30px;
  margin-bottom: 30px;
  box-shadow: var(--shadow);
  text-align: center;
  position: relative;
  overflow: hidden;
}

header::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%231abc9c' fill-opacity='0.03' fill-rule='evenodd'/%3E%3C/svg%3E");
  opacity: 0.1;
}

.logo {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 15px;
  position: relative;
  z-index: 2;
  margin-bottom: 15px;
}

.logo-icon {
  background: var(--light-color);
  width: 60px;
  height: 60px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.logo-icon i {
  font-size: 28px;
  color: var(--secondary-color);
}

.logo-text h1 {
  color: white;
  font-size: 28px;
  margin-bottom: 5px;
}

.logo-text p {
  color: rgba(255, 255, 255, 0.9);
  font-size: 14px;
}

.status-indicator {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  background: rgba(255, 255, 255, 0.15);
  padding: 8px 15px;
  border-radius: 50px;
  font-size: 14px;
  z-index: 2;
  backdrop-filter: blur(5px);
  margin-top: 10px;
}

.status-dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background-color: var(--success-color);
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0% { opacity: 0.8; }
  50% { opacity: 1; }
  100% { opacity: 0.8; }
}

.status-dot.offline {
  background-color: var(--danger-color);
}

.spinner {
  border: 2px solid rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  border-top: 2px solid white;
  width: 20px;
  height: 20px;
  animation: spin 1s linear infinite;
  display: none;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Main Content */
.card {
  background: var(--card-bg);
  border-radius: var(--radius);
  padding: 30px;
  box-shadow: var(--shadow);
  position: relative;
  overflow: hidden;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.card:hover {
  transform: translateY(-5px);
  box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
}

.card-title {
  color: var(--primary-color);
  margin-bottom: 25px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  padding-bottom: 15px;
  border-bottom: 2px solid var(--light-color);
  font-size: 22px;
  text-align: center;
}

.card-title i {
  color: var(--secondary-color);
}

/* Form Styles */
.form-group {
  margin-bottom: 25px;
}

label {
  display: block;
  margin-bottom: 10px;
  font-weight: 600;
  color: var(--primary-color);
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 16px;
}

.form-icon {
  color: var(--secondary-color);
  width: 20px;
  text-align: center;
}

select, input {
  width: 100%;
  padding: 16px 18px;
  background-color: #f8f9fa;
  border: 2px solid #e9ecef;
  border-radius: 10px;
  font-size: 16px;
  transition: all 0.3s;
  color: var(--dark-color);
}

select:focus, input:focus {
  border-color: var(--secondary-color);
  background-color: white;
  outline: none;
  box-shadow: 0 0 0 4px rgba(52, 152, 219, 0.15);
}

/* Button Styles */
button {
  background: linear-gradient(to right, var(--secondary-color), var(--accent-color));
  color: white;
  border: none;
  padding: 18px 30px;
  font-size: 18px;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.3s;
  font-weight: 600;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  box-shadow: 0 4px 6px rgba(50, 152, 219, 0.25);
  width: 100%;
  margin-top: 10px;
}

button:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 15px rgba(50, 152, 219, 0.3);
}

button:active {
  transform: translateY(0);
}

button:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none !important;
  box-shadow: none !important;
}

.btn-clear {
  background: linear-gradient(to right, var(--gray-color), #7f8c8d);
}

/* Notification */
.notification {
  position: fixed;
  top: 20px;
  right: 20px;
  background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
  color: white;
  padding: 18px 25px;
  border-radius: 10px;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
  transform: translateX(200%);
  transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
  display: flex;
  align-items: center;
  gap: 12px;
  z-index: 1000;
  max-width: 400px;
}

.notification.show {
  transform: translateX(0);
}

.notification.error {
  background: linear-gradient(to right, var(--danger-color), #c0392b);
}

.notification.warning {
  background: linear-gradient(to right, var(--warning-color), #e67e22);
}

/* Form Submission Animation */
@keyframes formSubmitted {
  0% { transform: scale(1); }
  50% { transform: scale(1.02); }
  100% { transform: scale(1); }
}

.form-submitted {
  animation: formSubmitted 0.5s ease;
}

/* Progress Indicator */
.progress-container {
  margin-top: 25px;
  background: #f8f9fa;
  border-radius: 10px;
  padding: 20px;
  display: none;
}

.progress-bar {
  height: 8px;
  background: #e9ecef;
  border-radius: 4px;
  overflow: hidden;
  margin-bottom: 10px;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(to right, var(--accent-color), var(--secondary-color));
  border-radius: 4px;
  width: 0%;
  transition: width 0.3s ease;
}

.progress-text {
  text-align: center;
  font-size: 14px;
  color: var(--gray-color);
}

/* Responsive Design */
@media (max-width: 768px) {
  body {
    padding: 15px;
  }
  
  .container {
    padding: 0;
  }
  
  .card {
    padding: 20px;
  }
  
  .logo {
    flex-direction: column;
    text-align: center;
  }
  
  .logo-text h1 {
    font-size: 24px;
  }
  
  button {
    padding: 16px 20px;
    font-size: 16px;
  }
  
  .notification {
    left: 20px;
    right: 20px;
    max-width: calc(100% - 40px);
  }
}

/* Custom Select Styling */
select {
  appearance: none;
  background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23333' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
  background-repeat: no-repeat;
  background-position: right 15px center;
  background-size: 16px;
  padding-right: 45px;
}

/* Custom Scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 10px;
}

::-webkit-scrollbar-thumb {
  background: var(--secondary-color);
  border-radius: 10px;
}

::-webkit-scrollbar-thumb:hover {
  background: #2980b9;
}
</style>
</head>
<body>

<div class="container">
  <header>
    <div class="logo">
      <div class="logo-icon">
        <i class="fas fa-hospital-alt"></i>
      </div>
      <div class="logo-text">
        <h1>Controle de Produtos Hospitalares</h1>
        <p>Registro único - Dados enviados diretamente para a planilha</p>
      </div>
    </div>
    <div class="status-indicator" id="status-indicator">
      <div class="status-dot" id="status-dot"></div>
      <span id="status-text">Online</span>
      <div class="spinner" id="spinner"></div>
    </div>
  </header>

  <div class="card">
    <h2 class="card-title"><i class="fas fa-edit"></i> Novo Registro</h2>
    <form id="hygieneForm" class="form-card">
      <div class="form-group">
        <label for="product"><i class="fas fa-pump-soap form-icon"></i> Produto:</label>
        <select id="product" name="product" required>
          <option value="">Selecione um produto</option>
          <option value="SABONETE LÍQUIDO (500 ml)">SABONETE LÍQUIDO (500 ml)</option>
          <option value="SABONETE LÍQUIDO (200 ml)">SABONETE LÍQUIDO (200 ml)</option>  
          <option value="SABONETE LIQUIDO CLOREX (1000ML)">SABONETE LIQUIDO CLOREX (1000ML)</option>
          <option value="ÁLCOOL EM GEL (700 ml)">ÁLCOOL EM GEL (700 ml)</option>
          <option value="ÁLCOOL PUMP (250 ml)">ÁLCOOL PUMP (250 ml)</option>
          <option value="ÁLCOOL ESPUMA (1000 ml)">ÁLCOOL ESPUMA (1000 ml)</option>
          <option value="ÁLCOOL PURELL (1200 ml)">ÁLCOOL PURELL (1200 ml)</option>
          <option value="ÁLCOOL ESPUMA (475 ml)">ÁLCOOL ESPUMA PUMP (475 ml)</option>
        </select>
      </div>

      <div class="form-group">
        <label for="sector"><i class="fas fa-building form-icon"></i> Setor:</label>
        <select id="sector" name="sector" required>
          <option value="">Selecione um setor</option>
          <option value="7º ANDAR - INTERNAÇÃO">7º ANDAR - INTERNAÇÃO</option>
          <option value="6º ANDAR - INTERNAÇÃO">6º ANDAR - INTERNAÇÃO</option>
          <option value="6º ANDAR - MATERNIDADE">6º ANDAR - MATERNIDADE</option>
          <option value="5º ANDAR - INTERNAÇÃO">5º ANDAR - INTERNAÇÃO</option>
          <option value="5º ANDAR - ONCOLOGIA">5º ANDAR - ONCOLOGIA</option>
          <option value="4º ANDAR - CEMED">4º ANDAR - CEMED</option>
          <option value="3º ANDAR - PEDIATRIA INTERNAÇÃO">3º ANDAR - PEDIATRIA INTERNAÇÃO</option>
          <option value="3º ANDAR - UTI PEDIATRICA">3º ANDAR - UTI PEDIATRICA</option>
          <option value="3º ANDAR - UTI NEONATAL">3º ANDAR - UTI NEONATAL</option>
          <option value="2º ANDAR CENTRO CIRURGICO">2º ANDAR CENTRO CIRURGICO</option>
          <option value="2º ANDAR CENTRO OBSTÉTRICO">2º ANDAR CENTRO OBSTÉTRICO</option>
          <option value="2º ANDAR - HOSPITAL DIA">2º ANDAR - HOSPITAL DIA</option>
          <option value="1º ANDAR ADULTO DML 01 – UTI">1º ANDAR ADULTO DML 01 – UTI</option>
          <option value="TÉRREO DML SADT">TÉRREO DML SADT</option>
          <option value="TÉRREO DML PSA">TÉRREO DML PSA</option>
          <option value="TÉRREO DML PSI">TÉRREO DML PSI</option>
          <option value="S1 DML 1 - MEDICINA DO TRABALHO">S1 DML 1 - MEDICINA DO TRABALHO</option>
          <option value="S1 DML 2 - MANUTENÇÃO">S1 DML 2 - MANUTENÇÃO</option>
        </select>
      </div>

      <div class="form-group">
        <label for="quantity"><i class="fas fa-boxes form-icon"></i> Quantidade:</label>
        <input type="number" id="quantity" name="quantity" min="1" value="1" placeholder="Quantidade" required>
      </div>

      <div class="form-group">
        <label for="date"><i class="fas fa-calendar-alt form-icon"></i> Data:</label>
        <input type="date" id="date" name="date" required>
      </div>

      <div class="form-group">
        <label for="registro-status"><i class="fas fa-info-circle form-icon"></i> Status:</label>
        <input type="text" id="registro-status" name="registro-status" value="Aguardando envio" readonly style="background-color: #fff3cd; font-weight: bold; color: var(--warning-color);">
      </div>

      <div class="progress-container" id="progress-container">
        <div class="progress-bar">
          <div class="progress-fill" id="progress-fill"></div>
        </div>
        <div class="progress-text" id="progress-text">Enviando registro...</div>
      </div>

      <button id="save-btn" type="submit"><i class="fas fa-paper-plane"></i> Enviar Registro</button>
      <button id="clear-btn" class="btn-clear" type="button"><i class="fas fa-redo"></i> Limpar Formulário</button>
    </form>
  </div>
</div>

<div class="notification" id="notification">
  <i class="fas fa-check-circle"></i>
  <span>Registro enviado com sucesso!</span>
</div>

<script>
// Elementos do DOM
const saveBtn = document.getElementById('save-btn');
const clearBtn = document.getElementById('clear-btn');
const productSelect = document.getElementById('product');
const sectorSelect = document.getElementById('sector');
const quantityInput = document.getElementById('quantity');
const dateInput = document.getElementById('date');
const notification = document.getElementById('notification');
const statusIndicator = document.getElementById('status-indicator');
const statusDot = document.getElementById('status-dot');
const statusText = document.getElementById('status-text');
const spinner = document.getElementById('spinner');
const form = document.getElementById('hygieneForm');
const statusField = document.getElementById("registro-status");
const progressContainer = document.getElementById('progress-container');
const progressFill = document.getElementById('progress-fill');
const progressText = document.getElementById('progress-text');

// Variáveis de estado
let isOnline = true;
let isSending = false;

// Função para obter data atual formatada
function getTodayDate() {
  const today = new Date();
  return today.toISOString().split('T')[0];
}

// Inicializar data no formulário
function initializeFormDate() {
  dateInput.value = getTodayDate();
  dateInput.max = getTodayDate();
}

// Verificar status da conexão
function checkOnlineStatus() {
  isOnline = navigator.onLine;
  updateStatusIndicator();
}

// Atualizar indicador de status
function updateStatusIndicator() {
  if (isOnline) {
    statusDot.classList.remove('offline');
    statusText.textContent = 'Online';
    statusIndicator.style.color = 'white';
  } else {
    statusDot.classList.add('offline');
    statusText.textContent = 'Offline';
    statusIndicator.style.color = '#ffcccc';
  }
}

// Mostrar notificação
function showNotification(message, type = 'success') {
  notification.querySelector('span').textContent = message;
  notification.className = 'notification';
  
  // Definir ícone baseado no tipo
  const icon = notification.querySelector('i');
  if (type === 'error') {
    notification.classList.add('error');
    icon.className = 'fas fa-exclamation-circle';
  } else if (type === 'warning') {
    notification.classList.add('warning');
    icon.className = 'fas fa-exclamation-triangle';
  } else {
    icon.className = 'fas fa-check-circle';
  }
  
  notification.classList.add('show');
  
  setTimeout(() => {
    notification.classList.remove('show');
  }, 4000);
}

// Mostrar progresso de envio
function showProgress(percent, text) {
  progressContainer.style.display = 'block';
  progressFill.style.width = `${percent}%`;
  progressText.textContent = text;
}

// Esconder progresso de envio
function hideProgress() {
  setTimeout(() => {
    progressContainer.style.display = 'none';
    progressFill.style.width = '0%';
  }, 500);
}

// Enviar dados para SheetMonkey
async function sendToSheetMonkey(record) {
  isSending = true;
  saveBtn.disabled = true;
  saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Enviando...';
  
  // Mostrar progresso
  showProgress(30, 'Conectando ao servidor...');
  
  try {
    // Simular progresso
    setTimeout(() => showProgress(60, 'Enviando dados...'), 500);
    
    const response = await fetch('https://api.sheetmonkey.io/form/9qTdVSMErCaMi6T6avZJKm', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        product: record.product,
        sector: record.sector,
        quantity: record.quantity,
        date: record.date,
        "registro-status": "Registrado",
        timestamp: new Date().toISOString()
      })
    });
    
    // Simular progresso final
    setTimeout(() => showProgress(90, 'Processando resposta...'), 1000);
    
    if (response.ok) {
      setTimeout(() => {
        showProgress(100, 'Registro enviado com sucesso!');
        hideProgress();
        
        // Atualizar status
        statusField.value = "Enviado com sucesso";
        statusField.style.backgroundColor = "#d4edda";
        statusField.style.color = "#155724";
        
        // Mostrar notificação
        showNotification('Registro enviado com sucesso para a planilha!');
        
        // Limpar campos após 1 segundo
        setTimeout(clearFields, 1000);
      }, 500);
      
      return true;
    } else {
      throw new Error('Falha no envio');
    }
  } catch (error) {
    console.error('Erro ao enviar para SheetMonkey:', error);
    
    showProgress(100, 'Erro no envio');
    setTimeout(() => {
      hideProgress();
      statusField.value = "Erro no envio";
      statusField.style.backgroundColor = "#f8d7da";
      statusField.style.color = "#721c24";
      showNotification('Erro ao enviar o registro. Verifique sua conexão e tente novamente.', 'error');
    }, 500);
    
    return false;
  } finally {
    isSending = false;
    saveBtn.disabled = false;
    saveBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Enviar Registro';
  }
}

// Limpar campos
function clearFields() {
  productSelect.value = '';
  sectorSelect.value = '';
  quantityInput.value = '1';
  dateInput.value = getTodayDate();
  statusField.value = "Aguardando envio";
  statusField.style.backgroundColor = "#fff3cd";
  statusField.style.color = "#856404";
}

// Salvar registro
async function saveRecord(e) {
  e.preventDefault();
  
  // Evitar envio duplicado
  if (isSending) {
    showNotification('Aguarde o envio atual ser concluído.', 'warning');
    return;
  }
  
  const product = productSelect.value;
  const sector = sectorSelect.value;
  const quantity = quantityInput.value;
  const date = dateInput.value;
  
  if (!product || !sector || !quantity || !date) {
    showNotification('Por favor, preencha todos os campos!', 'error');
    return;
  }
  
  // Validar quantidade
  if (quantity <= 0) {
    showNotification('A quantidade deve ser maior que zero!', 'error');
    return;
  }
  
  // Validar data (não pode ser futura)
  const today = new Date();
  const selectedDate = new Date(date);
  today.setHours(0, 0, 0, 0);
  
  if (selectedDate > today) {
    showNotification('A data não pode ser futura!', 'error');
    return;
  }
  
  const record = {
    product,
    sector,
    quantity,
    date,
    "registro-status": "Enviando...",
    timestamp: new Date().toISOString()
  };
  
  // Efeito visual de confirmação
  form.classList.add('form-submitted');
  setTimeout(() => {
    form.classList.remove('form-submitted');
  }, 500);
  
  // Atualizar status
  statusField.value = "Enviando...";
  statusField.style.backgroundColor = "#cce5ff";
  statusField.style.color = "#004085";
  
  // Enviar para SheetMonkey se estiver online
  if (isOnline) {
    await sendToSheetMonkey(record);
  } else {
    showNotification('Você está offline. Conecte-se à internet para enviar o registro.', 'error');
    statusField.value = "Aguardando conexão";
    statusField.style.backgroundColor = "#f8d7da";
    statusField.style.color = "#721c24";
  }
}

// Event Listeners
form.addEventListener('submit', saveRecord);
clearBtn.addEventListener('click', () => {
  clearFields();
  showNotification('Formulário limpo!');
});

// Verificar conexão ao carregar e durante mudanças
window.addEventListener('load', () => {
  checkOnlineStatus();
  initializeFormDate();
});

window.addEventListener('online', () => {
  isOnline = true;
  updateStatusIndicator();
  showNotification('Conexão restaurada. Você pode enviar registros.', 'warning');
});

window.addEventListener('offline', () => {
  isOnline = false;
  updateStatusIndicator();
  showNotification('Você está offline. Conecte-se para enviar registros.', 'error');
});

// Inicializar
document.addEventListener('DOMContentLoaded', function() {
  // Focar no primeiro campo
  productSelect.focus();
});
</script>
</body>
</html>
