<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Produtos Hospitalares</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(270deg, #d9d9d9, #abadc9);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 5px 5px 0;
            font-size: 16px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            background: #1e5799;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-icon i {
            font-size: 28px;
            color: white;
        }

        .logo-text h1 {
            color: #1e5799;
            font-size: 28px;
            margin-bottom: 5px;
        }

        .logo-text p {
            color: #2989d8;
            font-size: 14px;
        }

        /* AJUSTE PARA CENTRALIZAR O FORMULÁRIO */
        .main-content {
            display: flex;
            justify-content: center;
            gap: 30px;
        }

        .card {
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 800px;
        }

        .card-title {
            color: #1e5799;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 2px solid #eee;
            padding-bottom: 15px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #1e5799;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .hospital-icon {
            color: #e74c3c;
        }

        select, input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }

        button {
            background: linear-gradient(to right, #1e5799, #2989d8);
            color: white;
            border: none;
            padding: 14px 25px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-container {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .btn-clear {
            background: linear-gradient(to right, #e74c3c, #c0392b);
        }

        footer {
            text-align: center;
            color: white;
            margin-top: 30px;
            padding: 20px;
            font-size: 14px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #2ecc71;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transform: translateX(200%);
            transition: transform 0.3s ease-in-out;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1000;
        }

        .notification.show { transform: translateX(0); }
        .notification.error { background-color: #e74c3c; }

        .stats-container {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .stat-card {
            background: linear-gradient(to right, #1e5799, #2989d8);
            color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            flex: 1;
            min-width: 150px;
        }

        .stat-value { font-size: 24px; font-weight: bold; margin-top: 10px; }

        .status-indicator {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.9);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
        }

        .status-dot { width: 12px; height: 12px; border-radius: 50%; background-color: #27ae60; }
        .status-dot.offline { background-color: #e74c3c; }

        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 3px solid #1e5799;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: none;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
<div class="container">
    <header>
        <div class="logo">
            <div class="logo-icon"><i class="fas fa-hospital"></i></div>
            <div class="logo-text">
                <h1>Controle de Produtos Hospitalares</h1>
                <p>Sistema de gestão de insumos e produtos de higiene</p>
            </div>
        </div>
        <div class="status-indicator" id="status-indicator">
            <div class="status-dot" id="status-dot"></div>
            <span id="status-text">Online</span>
            <div class="spinner" id="spinner"></div>
        </div>
    </header>

    <div class="info-box">
        <p>Ao clicar no botão <strong>Salvar Registro</strong>, os dados serão automaticamente enviados para uma planilha específica, organizada por setor.</p>
    </div>

    <div class="main-content">
        <div class="card">
            <h2 class="card-title"><i class="fas fa-calculator"></i> Controle de Produtos</h2>
            <form id="hygieneForm">
                <div class="form-group">
                    <label for="product"><i class="fas fa-pump-soap hospital-icon"></i> Produto:</label>
                    <select id="product" name="product" required>
                        <option value="">Selecione um produto</option>
                        <option value="SABONETE LÍQUIDO (500 ml)">SABONETE LÍQUIDO (500 ml)</option>
                        <option value="SABONETE LÍQUIDO (200 ml)">SABONETE LÍQUIDO (200 ml)</option>
                        <option value="SABONETE LIQUIDO CLOREX (1000ML)">SABONETE LIQUIDO CLOREX (1000ML)</option>
                        <option value="ÁLCOOL EM GEL (700 ml)">ÁLCOOL EM GEL (700 ml)</option>
                        <option value="ÁLCOOL PUMP (250 ml)">ÁLCOOL PUMP (250 ml)</option>
                        <option value="ÁLCOOL ESPUMA (1000 ml)">ÁLCOOL ESPUMA (1000 ml)</option>
                        <option value="ÁLCOOL PURELL (1200 ml)">ÁLCOOL PURELL (1200 ml)</option>
                        <option value="ÁLCOOL ESPUMA (475 ml)">ÁLCOOL ESPUMA PUMP (475 ml)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="sector"><i class="fas fa-building hospital-icon"></i> Setor:</label>
                    <select id="sector" name="sector" required>
                        <option value="">Selecione um setor</option>
                        <option value="7º ANDAR - INTERNAÇÃO">7º ANDAR - INTERNAÇÃO</option>
                        <option value="6º ANDAR - INTERNAÇÃO">6º ANDAR - INTERNAÇÃO</option>
                        <option value="6º ANDAR - MATERNIDADE">6º ANDAR - MATERNIDADE</option>
                        <option value="5º ANDAR - INTERNAÇÃO">5º ANDAR - INTERNAÇÃO</option>
                        <option value="5º ANDAR - ONCOLOGIA">5º ANDAR - ONCOLOGIA</option>
                        <option value="4º ANDAR - CEMED">4º ANDAR - CEMED</option>
                        <option value="3º ANDAR - PEDIATRIA INTERNAÇÃO">3º ANDAR - PEDIATRIA INTERNAÇÃO</option>
                        <option value="3º ANDAR - UTI PEDIATRICA">3º ANDAR - UTI PEDIATRICA</option>
                        <option value="3º ANDAR - UTI NEONATAL">3º ANDAR - UTI NEONATAL</option>
                        <option value="2º ANDAR CENTRO CIRURGICO">2º ANDAR CENTRO CIRURGICO</option>
                        <option value="2º ANDAR CENTRO OBSTÉTRICO">2º ANDAR CENTRO OBSTÉTRICO</option>
                        <option value="2º ANDAR - HOSPITAL DIA">2º ANDAR - HOSPITAL DIA</option>
                        <option value="1º ANDAR ADULTO DML 01 – UTI">1º ANDAR ADULTO DML 01 – UTI</option>
                        <option value="TÉRREO DML SADT">TÉRREO DML SADT</option>
                        <option value="TÉRREO DML PSA">TÉRREO DML PSA</option>
                        <option value="TÉRREO DML PSI">TÉRREO DML PSI</option>
                        <option value="S1 DML 1 - MEDICINA DO TRABALHO">S1 DML 1 - MEDICINA DO TRABALHO</option>
                        <option value="S1 DML 2 - MANUTENÇÃO">S1 DML 2 - MANUTENÇÃO</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="quantity"><i class="fas fa-boxes hospital-icon"></i> Quantidade:</label>
                    <input type="number" id="quantity" name="quantity" min="1" value="1" required>
                </div>

                <div class="form-group">
                    <label for="date"><i class="fas fa-calendar-alt hospital-icon"></i> Data:</label>
                    <input type="date" id="date" name="date" required>
                </div>

                <div class="form-group">
                    <label for="registro-status"><i class="fas fa-info-circle hospital-icon"></i> Status do Registro:</label>
                    <input type="text" id="registro-status" name="registro-status" value="Registrado" readonly style="background-color: #f9f9f9; font-weight: bold; color: #28a745;">
                </div>

                <div class="btn-container">
                    <button id="save-btn" type="submit"><i class="fas fa-save"></i> Salvar Registro</button>
                    <button id="clear-btn" class="btn-clear" type="button"><i class="fas fa-trash-alt"></i> Limpar</button>
                </div>

                <div class="stats-container">
                    <div class="stat-card">
                        <div class="stat-label">Total de Registros</div>
                        <div class="stat-value" id="total-records">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Enviados</div>
                        <div class="stat-value" id="sent-records">0</div>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <footer>
        <p>Sistema de Controle de Produtos Hospitalares &copy; 2025 - Desenvolvido para o Hospital São Luiz Campinas</p>
    </footer>
</div>

<div class="notification" id="notification">
    <i class="fas fa-check-circle"></i>
    <span>Registro salvo com sucesso!</span>
</div>

<script>
    // Elementos do DOM
    const saveBtn = document.getElementById('save-btn');
    const clearBtn = document.getElementById('clear-btn');
    const productSelect = document.getElementById('product');
    const sectorSelect = document.getElementById('sector');
    const quantityInput = document.getElementById('quantity');
    const dateInput = document.getElementById('date');
    const notification = document.getElementById('notification');
    const totalRecordsElement = document.getElementById('total-records');
    const sentRecordsElement = document.getElementById('sent-records');
    const statusDot = document.getElementById('status-dot');
    const statusText = document.getElementById('status-text');
    const spinner = document.getElementById('spinner');
    const form = document.getElementById('hygieneForm');
    const statusField = document.getElementById("registro-status");

    let isOnline = true;
    let sentCount = 0;

    function getTodayDate() { return new Date().toISOString().split('T')[0]; }

    function checkOnlineStatus() {
        isOnline = navigator.onLine;
        statusDot.className = isOnline ? 'status-dot' : 'status-dot offline';
        statusText.textContent = isOnline ? 'Online' : 'Offline';
    }

    function updateStats() {
        const history = JSON.parse(localStorage.getItem('productHistory')) || [];
        totalRecordsElement.textContent = history.length;
        sentRecordsElement.textContent = sentCount;
    }

    function showNotification(message, type = 'success') {
        notification.querySelector('span').textContent = message;
        notification.className = 'notification' + (type === 'error' ? ' error' : '') + ' show';
        setTimeout(() => notification.classList.remove('show'), 3000);
    }

    async function sendToSheetMonkey(record) {
        spinner.style.display = 'inline-block';
        try {
            const response = await fetch('https://api.sheetmonkey.io/form/9qTdVSMErCaMi6T6avZJKm', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(record)
            });
            if (response.ok) {
                sentCount++;
                updateStats();
            }
        } catch (error) {
            console.error('Erro ao enviar:', error);
        } finally {
            spinner.style.display = 'none';
        }
    }

    function saveRecord(e) {
        e.preventDefault();
        const record = {
            product: productSelect.value,
            sector: sectorSelect.value,
            quantity: quantityInput.value,
            date: dateInput.value,
            "registro-status": statusField.value,
            id: Date.now()
        };

        const history = JSON.parse(localStorage.getItem('productHistory')) || [];
        history.push(record);
        localStorage.setItem('productHistory', JSON.stringify(history));

        if (isOnline) {
            sendToSheetMonkey(record);
        } else {
            showNotification('Salvo localmente (offline)', 'warning');
        }

        updateStats();
        clearFields();
        showNotification('Registro salvo com sucesso!');
    }

    function clearFields() {
        productSelect.value = '';
        sectorSelect.value = '';
        quantityInput.value = '1';
        dateInput.value = getTodayDate();
    }

    form.addEventListener('submit', saveRecord);
    clearBtn.addEventListener('click', clearFields);
    window.addEventListener('online', checkOnlineStatus);
    window.addEventListener('offline', checkOnlineStatus);

    window.addEventListener('load', () => {
        checkOnlineStatus();
        dateInput.value = getTodayDate();
        updateStats();
    });
</script>
</body>
</html>
